# English Mistake Review Tool - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 产品定位
English Mistake Review Tool 是一款专为英语学习者设计的Web应用程序，通过间隔重复学习法（Spaced Repetition）帮助用户系统性地复习和掌握常见的英语错误。

### 1.2 产品愿景
让英语学习者能够高效、系统地复习和巩固自己的错误，通过科学的记忆曲线算法，将错误转化为长期记忆，最终提升英语水平。

### 1.3 目标用户
- 英语学习者（初级到高级）
- 需要系统化复习错误的用户
- 希望提高英语准确性的用户
- 需要跟踪学习进度的用户

## 2. 核心功能需求

### 2.1 错误记录功能

#### 2.1.1 单个错误添加
**功能描述：** 用户可以添加单个英语错误记录

**输入字段：**
- 错误句子（必填）：用户写错的句子
- 正确句子（必填）：正确的句子
- 说明（可选）：对错误的解释或说明

**业务规则：**
- 错误句子和正确句子为必填项
- 系统自动设置初始复习日期为当天（Day 0）
- 初始状态为"未学习"（unlearned）
- 初始复习阶段为0

#### 2.1.2 批量错误添加
**功能描述：** 用户可以批量导入多个错误记录

**输入格式：**
```
错误句子 | 正确句子 | 说明（可选）
```

**示例：**
```
I have went to school | I have gone to school | 使用have时应该用过去分词
He don't like it | He doesn't like it | 第三人称单数用doesn't
```

**业务规则：**
- 每行一个错误记录
- 使用 `|` 分隔字段
- 说明字段可选
- 系统自动解析并创建多个错误记录

### 2.2 间隔重复复习系统

#### 2.2.1 复习算法
**算法类型：** 简化的艾宾浩斯遗忘曲线

**复习阶段：**
- **阶段 0**：创建当天（Day 0）
- **阶段 1**：创建后第3天（Day 3）
- **阶段 2**：创建后第7天（Day 7）
- **阶段 3**：创建后第14天（Day 14）
- **阶段 4**：创建后第30天（Day 30）

**复习逻辑：**
- 如果用户标记为"已掌握"（Got It）：进入下一阶段
- 如果用户标记为"需要更多练习"（Need More Practice）：重置到阶段0
- 完成阶段4并标记为"已掌握"后，状态变为"已学习"（learned）

#### 2.2.2 复习界面
**功能描述：** 卡片式复习界面

**显示流程：**
1. **错误展示阶段：**
   - 显示错误句子
   - 提供"显示答案"按钮

2. **答案展示阶段：**
   - 显示正确句子
   - 显示说明（如果有）
   - 提供两个操作按钮：
     - "需要更多练习"（重置到阶段0）
     - "已掌握"（进入下一阶段）

**进度显示：**
- 显示当前进度：X / 总数
- 显示进度百分比
- 进度条可视化

### 2.3 仪表盘功能

#### 2.3.1 今日复习
**显示内容：**
- 今日需要复习的错误数量
- "开始复习"按钮（跳转到复习页面）

#### 2.3.2 统计卡片
**显示指标：**
1. **总错误数**：所有记录的错误总数
2. **已学习**：状态为"已学习"的错误数量
3. **学习中**：状态为"未学习"的错误数量
4. **连续天数**：连续完成复习的天数

#### 2.3.3 快速操作
**功能入口：**
- 添加错误
- 错误库
- 复习日历

### 2.4 错误库管理

#### 2.4.1 错误列表
**显示内容：**
- 错误句子
- 正确句子
- 说明
- 状态（已学习/学习中）
- 复习阶段（X/5）
- 复习次数
- 创建日期
- 下次复习日期

#### 2.4.2 搜索和筛选
**搜索功能：**
- 支持在错误句子、正确句子、说明中搜索
- 实时搜索

**筛选功能：**
- 按状态筛选（全部/已学习/学习中）

#### 2.4.3 错误管理
**操作功能：**
- 删除错误（需确认）
- 查看错误详情

### 2.5 日历视图

#### 2.5.1 日历展示
**显示内容：**
- 月视图日历
- 标记有复习任务的日期
- 显示每日复习数量
- 高亮今天

#### 2.5.2 日历导航
**功能：**
- 上一月/下一月切换
- 跳转到今天
- 月份和年份显示

#### 2.5.3 日期详情
**功能：**
- 点击有复习任务的日期
- 显示该日期的所有复习任务
- 显示错误的详细信息
- 提供"复习这些错误"按钮

#### 2.5.4 日历统计
**显示指标：**
- 本月总复习任务数
- 有复习任务的天数
- 平均每天复习数量

## 3. 技术架构

### 3.1 技术栈

#### 3.1.1 前端
- **框架：** Next.js 15（App Router）
- **UI库：** React 19
- **语言：** TypeScript
- **样式：** Tailwind CSS
- **日期处理：** date-fns

#### 3.1.2 后端
- **API：** Next.js API Routes
- **数据库：** Supabase (PostgreSQL)
- **ORM：** Supabase Client

### 3.2 数据库设计

#### 3.2.1 错误表（mistakes）
```sql
create type mistake_status as enum ('unlearned', 'learned');

create table public.mistakes (
  id uuid primary key default gen_random_uuid(),
  created_at timestamptz not null default now(),
  error_sentence text not null,
  correct_sentence text not null,
  explanation text,
  status mistake_status not null default 'unlearned',
  next_review_at timestamptz not null,
  review_stage integer not null default 0,
  review_count integer not null default 0,
  content_type content_type not null default 'mistake',
  last_reviewed_at timestamptz
);
```

#### 3.2.2 字段说明
- **id：** 唯一标识符（UUID）
- **created_at：** 创建时间
- **error_sentence：** 错误句子
- **correct_sentence：** 正确句子
- **explanation：** 说明
- **status：** 学习状态
- **next_review_at：** 下次复习时间
- **review_stage：** 当前复习阶段（0-4）
- **review_count：** 复习次数
- **content_type：** 内容类型（mistake/expression）
- **last_reviewed_at：** 最后一次实际复习时间

### 3.3 API接口设计

#### 3.3.1 错误管理接口

**GET /api/mistakes**
- **功能：** 获取错误列表
- **查询参数：**
  - `status`：按状态筛选
  - `search`：搜索关键词
  - `todayReview`：获取今日复习任务
- **返回：** 错误数组

**POST /api/mistakes**
- **功能：** 创建单个错误
- **请求体：**
  ```json
  {
    "error_sentence": "错误句子",
    "correct_sentence": "正确句子",
    "explanation": "说明（可选）"
  }
  ```
- **返回：** 创建的错误ID

**PUT /api/mistakes/[id]**
- **功能：** 更新错误（复习反馈）
- **请求体：**
  ```json
  {
    "isCorrect": true/false
  }
  ```
- **返回：** 更新后的状态信息

**DELETE /api/mistakes/[id]**
- **功能：** 删除错误
- **返回：** 删除成功消息

**POST /api/mistakes/batch**
- **功能：** 批量创建错误
- **请求体：**
  ```json
  {
    "batchText": "批量文本"
  }
  ```
- **返回：** 创建的错误数量

#### 3.3.2 仪表盘接口

**GET /api/dashboard**
- **功能：** 获取仪表盘统计数据
- **返回：**
  ```json
  {
    "todayReviewCount": 今日复习数量,
    "totalMistakes": 总错误数,
    "learnedMistakes": 已学习数量,
    "unlearnedMistakes": 学习中数量,
    "recentMistakes": [{"date": "日期", "count": 数量}],
    "streak": 连续天数,
    "lastUpdated": "更新时间"
  }
  ```

#### 3.3.3 日历接口

**GET /api/calendar**
- **功能：** 获取日历数据
- **查询参数：**
  - `year`：年份
  - `month`：月份（1-12）
  - `date`：具体日期（获取该日期的复习任务）
- **返回：**
  ```json
  {
    "reviewCounts": {"日期": 数量},
    "mistakesForDate": [错误数组],
    "year": 年份,
    "month": 月份
  }
  ```

## 4. 用户界面设计

### 4.1 页面结构

#### 4.1.1 导航栏
- 固定顶部导航
- 包含主要功能入口
- 响应式设计

#### 4.1.2 页面布局
- 响应式网格布局
- 移动端优先设计
- 卡片式UI组件

### 4.2 页面列表

1. **首页（Dashboard）** - `/`
   - 今日复习卡片
   - 统计卡片
   - 快速操作入口

2. **添加错误页** - `/add`
   - 单个/批量切换
   - 表单输入
   - 提交按钮

3. **复习页** - `/review`
   - 复习准备界面
   - 卡片式复习界面
   - 进度显示

4. **错误库页** - `/library`
   - 搜索和筛选栏
   - 错误列表
   - 删除操作

5. **日历页** - `/calendar`
   - 月视图日历
   - 日期详情弹窗
   - 统计信息

## 5. 业务规则

### 5.1 复习调度规则

1. **初始创建：**
   - 创建时设置 `next_review_at` 为当天
   - `review_stage` 为 0
   - `status` 为 'unlearned'

2. **复习反馈：**
   - 标记"已掌握"：`review_stage` + 1（最大为4）
   - 标记"需要更多练习"：`review_stage` 重置为 0
   - `review_count` 每次 + 1

3. **下次复习时间计算：**
   - 基于 `created_at` 和 `review_stage`
   - 阶段0：创建当天
   - 阶段1：创建后第3天
   - 阶段2：创建后第7天
   - 阶段3：创建后第14天
   - 阶段4：创建后第30天

4. **状态更新：**
   - 完成阶段4并标记"已掌握"：`status` 变为 'learned'
   - 其他情况：`status` 保持 'unlearned'

### 5.2 今日复习规则

- 今日复习任务：`next_review_at` 在今天的错误
- 时间范围：当天 00:00:00 到次日 00:00:00

### 5.3 连续天数计算规则

- 基于已完成复习的错误（status='learned'）的 `next_review_at`
- 从今天开始往前计算连续天数
- 如果某天没有完成复习，连续天数中断

## 6. 非功能性需求

### 6.1 性能要求
- 页面加载时间 < 2秒
- API响应时间 < 500ms
- 支持1000+错误记录

### 6.2 可用性要求
- 响应式设计，支持移动端和桌面端
- 浏览器兼容：Chrome、Firefox、Safari、Edge（最新版本）
- 无障碍访问支持

### 6.3 安全性要求
- 数据验证和清理
- SQL注入防护（使用参数化查询）
- XSS防护

### 6.4 可维护性要求
- TypeScript类型安全
- 代码注释和文档
- 错误处理和日志记录

## 7. 未来功能规划

### 7.1 短期规划（v1.1）
- 邮件/通知提醒功能
- 高级统计和图表
- 数据导出功能（CSV/JSON）

### 7.2 中期规划（v1.2）
- 用户认证和多用户支持
- 移动端App
- 音频发音支持

### 7.3 长期规划（v2.0）
- 选择题测验模式
- 与外部学习平台集成
- AI智能错误分析
- 学习社区功能

## 8. 项目状态

### 8.1 已完成功能（MVP 1.0）
✅ 单个错误添加
✅ 批量错误添加
✅ 错误存储和管理
✅ 卡片式复习界面
✅ 间隔重复算法（简化艾宾浩斯曲线）
✅ 仪表盘和任务概览
✅ 日历显示复习任务
✅ 搜索和筛选功能
✅ 响应式设计（Tailwind CSS）

### 8.2 技术债务
- 需要完善错误处理
- 需要添加单元测试
- 需要优化数据库查询性能
- 需要添加数据验证

## 9. 部署说明

### 9.1 环境要求
- Node.js 18+
- npm 或 yarn
- Supabase 账户

### 9.2 环境变量
```
SUPABASE_URL=...
SUPABASE_SERVICE_ROLE_KEY=...
SUPABASE_ANON_KEY=...
```

### 9.3 部署步骤
1. 克隆仓库
2. 安装依赖：`npm install`
3. 配置环境变量
4. 运行开发服务器：`npm run dev`
5. 构建生产版本：`npm run build`
6. 启动生产服务器：`npm start`

## 10. 附录

### 10.1 术语表
- **间隔重复（Spaced Repetition）：** 一种学习技术，通过在不同时间间隔复习来增强记忆
- **艾宾浩斯遗忘曲线：** 描述人类记忆随时间衰减的曲线
- **复习阶段（Review Stage）：** 错误在复习流程中的当前位置（0-4）
- **学习状态（Status）：** 错误的掌握状态（已学习/未学习）

### 10.2 参考资料
- Next.js 官方文档
- Supabase 官方文档
- 间隔重复学习法研究

---

**文档版本：** 1.0  
**最后更新：** 2024年  
**维护者：** 项目团队
