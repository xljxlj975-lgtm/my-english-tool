# è´Ÿè½½å‡è¡¡ä¿®å¤è¯´æ˜

## é—®é¢˜è¯Šæ–­

### ç°è±¡
ä»æ—¥å†å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ—¥å¤ä¹ é‡æ³¢åŠ¨æå¤§ï¼š
- 12æœˆ16æ—¥ï¼š**126å¼ ** ğŸ˜±
- 12æœˆ17æ—¥ï¼š47å¼ 
- 12æœˆ18æ—¥ï¼š**100å¼ **
- 12æœˆ19æ—¥ï¼š33å¼ 
- 12æœˆ23æ—¥ï¼š3å¼ 
- 1æœˆ1æ—¥ï¼š**166å¼ **ï¼

### æ ¹æœ¬åŸå› 

æ„Ÿè°¢æœ‹å‹çš„ç²¾å‡†åˆ†æï¼Œé—®é¢˜å‡ºåœ¨**è°ƒåº¦ç¯èŠ‚ç¼ºå°‘è´Ÿè½½å‡è¡¡**ï¼š

1. **åŠ¨æ€fuzzingè¢«æ³¨é‡Šæ‰äº†**
   - `src/app/api/mistakes/[id]/route.ts:95` ä¸­ `reviewLoadMap` è¢«æ³¨é‡Š
   - åªä½¿ç”¨é™æ€fuzzingï¼ˆÂ±3~14å¤©ï¼‰ï¼ŒåŸºäºå¡ç‰‡ID
   - åŒä¸€å¤©æ‰¹é‡æ·»åŠ /æ‰“åˆ†çš„å¡ç‰‡ä¼šæ²¿ç€å›ºå®šèŠ‚å¥ï¼ˆ1/3/7/14...ï¼‰æ‰å †

2. **æ–°å»ºå¡ç‰‡ä¹Ÿæ²¡æœ‰è´Ÿè½½å‡è¡¡**
   - `POST /api/mistakes` ä½¿ç”¨æ—§çš„ `calculateNextReviewDate`
   - ä¸æŸ¥è¯¢æœªæ¥è´Ÿè½½ï¼Œæ‰€æœ‰æ–°å¡é¦–æ—¥/æ¬¡æ—¥å †åœ¨ä¸€èµ·

3. **review-queueåªæˆªæ–­æ˜¾ç¤ºï¼Œä¸æ§åˆ¶è°ƒåº¦**
   - åªç”¨ `daily_target` é™åˆ¶æ˜¾ç¤ºæ•°é‡
   - è°ƒåº¦ç«¯ä¸æ§é‡ â†’ åˆ°æœŸç«¯æ³¢åŠ¨å¤§

---

## è§£å†³æ–¹æ¡ˆ

### 1. å¯ç”¨åŠ¨æ€è´Ÿè½½å‡è¡¡ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š`src/app/api/mistakes/[id]/route.ts`

```typescript
// ä¹‹å‰ï¼ˆè¢«æ³¨é‡Šï¼‰
// reviewLoadMap: await getFutureReviewLoad(supabase, 14),

// ç°åœ¨ï¼ˆå·²å¯ç”¨ï¼‰
const reviewLoadMap = await getFutureReviewLoad(supabase, 14);
const result = calculateNextReview({
  // ...
  reviewLoadMap,  // â† å¯ç”¨ï¼
});
```

**æ•ˆæœ**ï¼š
- æ¯æ¬¡å¤ä¹ æ—¶æŸ¥è¯¢æœªæ¥14å¤©çš„è´Ÿè½½
- æ™ºèƒ½é€‰æ‹©è´Ÿè½½æœ€ä½çš„æ—¥æœŸ
- é¿å…å¤ä¹ æ—¥æœŸæ‰å †

### 2. æ–°å»ºå¡ç‰‡ä¹Ÿä½¿ç”¨åŠ¨æ€å‡è¡¡ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š`src/app/api/mistakes/route.ts`

```typescript
// ä¹‹å‰ï¼ˆæ—§APIï¼‰
const { nextReviewAt } = calculateNextReviewDate(0, false, null, now);

// ç°åœ¨ï¼ˆæ–°API + è´Ÿè½½å‡è¡¡ï¼‰
const reviewLoadMap = await getFutureReviewLoad(supabase, 14);
const result = calculateNextReview({
  currentStage: 0,
  score: Score.Forgot,
  // ...
  reviewLoadMap,  // â† æ–°å¡ä¹Ÿåˆ†æ•£ï¼
});
```

**æ•ˆæœ**ï¼š
- æ‰¹é‡æ·»åŠ å¡ç‰‡æ—¶ï¼Œé¦–æ¬¡å¤ä¹ æ—¶é—´ä¼šè¢«åˆ†æ•£
- ä¸ä¼šæ‰€æœ‰æ–°å¡éƒ½æŒ¤åœ¨ç¬¬1å¤©æˆ–ç¬¬2å¤©

### 3. ä¼˜åŒ–Fuzzingç®—æ³• âœ…

**å¢å¼ºè§„åˆ™**ï¼š

a) **å¢å¤§åç§»æƒ©ç½š**ï¼ˆé˜²æ­¢æ¨å¤ªè¿œï¼‰
```typescript
// ä¹‹å‰ï¼šåç§»æƒ©ç½š = abs(offset) * 0.5
// ç°åœ¨ï¼šåç§»æƒ©ç½š = abs(offset) * 1.0

// çŸ­é—´éš”å¡ç‰‡ï¼ˆ<7å¤©ï¼‰æƒ©ç½šæ›´å¤§
const penaltyMultiplier = interval < 7 ? 1.5 : 1.0;
```

b) **é™åˆ¶æœ€å¤§åç§»**ï¼ˆä¿æŠ¤è®°å¿†èŠ‚å¥ï¼‰
```typescript
// ä¸å…è®¸åç§»è¶…è¿‡é—´éš”çš„25%æˆ–7å¤©ï¼ˆå–è¾ƒå°å€¼ï¼‰
const maxOffset = Math.min(
  Math.ceil(interval * 0.25),
  7
);
```

c) **é™ä½fuzzyRangeä¸Šé™**
```typescript
// ä¹‹å‰ï¼šæœ€å¤šÂ±14å¤©
// ç°åœ¨ï¼šæœ€å¤šÂ±10å¤©
const fuzzyRange = Math.max(3, Math.min(Math.floor(interval * 0.2), 10));
```

---

## é¢„æœŸæ•ˆæœ

### è´Ÿè½½æ³¢åŠ¨æ”¹å–„

**ä¿®å¤å‰**ï¼ˆå½“å‰çŠ¶æ€ï¼‰ï¼š
```
12/16: 126 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/17:  47 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/18: 100 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/19:  33 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/23:   3 â–Œ
```
**æ³¢åŠ¨èŒƒå›´**: 3-126 (42å€å·®è·ï¼)

**ä¿®å¤å**ï¼ˆé¢„æœŸï¼‰ï¼š
```
12/16:  52 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/17:  48 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/18:  51 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/19:  49 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
12/20:  47 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```
**æ³¢åŠ¨èŒƒå›´**: 47-52 (æ§åˆ¶åœ¨Â±10%)

### å…³é”®æŒ‡æ ‡

- âœ… æ¯æ—¥è´Ÿè½½æ§åˆ¶åœ¨ `Â±10-20%` èŒƒå›´å†…
- âœ… é¿å…å•æ—¥è¶…è¿‡100å¼ çš„æç«¯æƒ…å†µ
- âœ… ä¸ä¼šå‡ºç°åªæœ‰3å¼ çš„"ç©ºçª—æœŸ"
- âœ… è®°å¿†èŠ‚å¥ä¸è¢«æ‰“ä¹±ï¼ˆåç§»é™åˆ¶åœ¨7å¤©å†…ï¼‰

---

## ä½¿ç”¨æŒ‡å—

### ç«‹å³ç”Ÿæ•ˆ

1. **å…ˆæ‰§è¡Œæ•°æ®åº“è¿ç§»**ï¼ˆå¦‚æœè¿˜æ²¡åšï¼‰ï¼š
   ```bash
   # åœ¨Supabase Dashboard SQL Editorè¿è¡Œ
   migrations/v3.0-enhanced-srs.sql
   ```

2. **éªŒè¯è¿ç§»**ï¼š
   ```bash
   node scripts/validate-migration.js
   ```

3. **é‡æ–°åˆ†æ•£ç°æœ‰å¡ç‰‡**ï¼ˆå¯é€‰ï¼Œå¼ºçƒˆæ¨èï¼‰ï¼š
   ```bash
   node scripts/redistribute-reviews.js
   ```

   è¿™ä¸ªè„šæœ¬ä¼šï¼š
   - é‡æ–°è®¡ç®—æ‰€æœ‰ç°æœ‰å¡ç‰‡çš„ `next_review_at`
   - åº”ç”¨æ–°çš„fuzzingç®—æ³•
   - æ˜¾ç¤ºé‡æ–°åˆ†æ•£å‰åçš„å¯¹æ¯”

4. **å¯åŠ¨åº”ç”¨å¹¶æµ‹è¯•**ï¼š
   ```bash
   npm run dev
   ```

### æœªæ¥æ–°å¡ç‰‡å’Œå¤ä¹ 

- **è‡ªåŠ¨ç”Ÿæ•ˆ**ï¼šæ–°æ·»åŠ çš„å¡ç‰‡å’Œæ¯æ¬¡å¤ä¹ éƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨åŠ¨æ€è´Ÿè½½å‡è¡¡
- **æ— éœ€æ‰‹åŠ¨å¹²é¢„**ï¼šç³»ç»Ÿä¼šæŒç»­ä¿æŒè´Ÿè½½å¹³ç¨³

---

## æŠ€æœ¯ç»†èŠ‚

### åŠ¨æ€Fuzzingå·¥ä½œåŸç†

1. **è·å–æœªæ¥è´Ÿè½½**
   ```typescript
   const reviewLoadMap = {
     '2025-12-16': 52,
     '2025-12-17': 48,
     '2025-12-18': 51,
     // ...
   };
   ```

2. **è¯„åˆ†å€™é€‰æ—¥æœŸ**
   ```typescript
   // å¯¹äºbaseDate + offsetçš„æ¯ä¸ªå€™é€‰æ—¥æœŸ
   score = load + abs(offset) * penaltyMultiplier

   // ä¾‹å¦‚ï¼š
   // baseDateæ˜¯12/16, è´Ÿè½½52, offset=0 â†’ score = 52 + 0 = 52
   // baseDateæ˜¯12/17, è´Ÿè½½48, offset=+1 â†’ score = 48 + 1 = 49 â† æ›´å¥½ï¼
   // baseDateæ˜¯12/18, è´Ÿè½½51, offset=+2 â†’ score = 51 + 2 = 53
   ```

3. **é€‰æ‹©æœ€ä½³æ—¥æœŸ**
   - é€‰æ‹©scoreæœ€ä½çš„æ—¥æœŸ
   - ä½†ä¸å…è®¸åç§»è¶…è¿‡é™åˆ¶ï¼ˆ25%æˆ–7å¤©ï¼‰
   - ç»“æœï¼šå¤ä¹ æ—¶é—´æ—¢åˆ†æ•£ï¼Œåˆä¸ç ´åè®°å¿†èŠ‚å¥

---

## æ–¹æ¡ˆå¯¹æ¯”

### æˆ‘æœ€åˆçš„æ–¹æ¡ˆï¼ˆæ²»æ ‡ï¼‰
- âŒ åªæ˜¯ä¸€æ¬¡æ€§ä¿®å¤å†å²æ•°æ®
- âŒ æœªæ¥ä»ä¼šå‡ºç°æ³¢åŠ¨
- âœ… å¯ä»¥å¿«é€Ÿç¼“è§£å½“å‰é—®é¢˜

### æœ‹å‹çš„æ–¹æ¡ˆï¼ˆæ²»æœ¬ï¼‰âœ…
- âœ… ä»æºå¤´è§£å†³é—®é¢˜
- âœ… å¯ç”¨å·²æœ‰çš„åŠ¨æ€å‡è¡¡ä»£ç 
- âœ… é˜²æ­¢æœªæ¥å†æ¬¡å‡ºç°
- âœ… é•¿æœŸç¨³å®š

**æœ€ä½³æ–¹æ¡ˆ**ï¼šä¸¤è€…ç»“åˆ
1. ç”¨è„šæœ¬ä¿®å¤å†å²æ•°æ®ï¼ˆredistribute-reviews.jsï¼‰
2. å¯ç”¨åŠ¨æ€å‡è¡¡é˜²æ­¢æœªæ¥é—®é¢˜

---

## åç»­ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

ä½ æœ‹å‹è¿˜æåˆ°çš„å…¶ä»–ä¼˜åŒ–ï¼Œå¯ä»¥åœ¨æœªæ¥å®ç°ï¼š

### 3. æº¢å‡ºæ»šåŠ¨æœºåˆ¶
- å½“æŸå¤©è¶…è¿‡ `daily_target * 1.2`ï¼Œè‡ªåŠ¨æ¨è¿Ÿä½ä¼˜å…ˆçº§å¡ç‰‡
- å½“æŸå¤©ä¸è¶³ç›®æ ‡ï¼Œä»æœªæ¥æ‹‰å–å¥åº·æ£€æŸ¥è¡¥é½

### 4. UIåé¦ˆ
- Dashboardæ˜¾ç¤ºæœªæ¥7-14å¤©è´Ÿè½½é¢„æµ‹
- æ˜¾ç¤ºä»Šæ—¥æº¢å‡º/ç¼ºå£æƒ…å†µ
- ç”¨æˆ·ç†è§£ä¸ºä»€ä¹ˆè¢«æå‰æˆ–æ¨å

è¿™äº›åŠŸèƒ½åœ¨Phase 5ä¼šå®ç°ã€‚

---

## æ€»ç»“

âœ… **å·²è§£å†³**ï¼š
- åŠ¨æ€è´Ÿè½½å‡è¡¡å·²å¯ç”¨
- æ–°å»ºå¡ç‰‡ä¹Ÿä¼šåˆ†æ•£
- Fuzzingç®—æ³•å·²ä¼˜åŒ–
- åç§»é™åˆ¶å·²æ·»åŠ 

ğŸ¯ **é¢„æœŸæ•ˆæœ**ï¼š
- æ—¥æ³¢åŠ¨æ”¶æ•›åˆ°Â±10-20%
- ä¸å†å‡ºç°126 vs 3çš„æç«¯æƒ…å†µ
- è®°å¿†èŠ‚å¥ä¸è¢«æ‰“ä¹±

ğŸ“ **ä¸‹ä¸€æ­¥**ï¼š
1. æ‰§è¡Œæ•°æ®åº“è¿ç§»
2. è¿è¡Œredistributeè„šæœ¬ä¿®å¤å†å²æ•°æ®
3. æµ‹è¯•å¹¶è§‚å¯Ÿæ•ˆæœ

---

**æ„Ÿè°¢æœ‹å‹çš„ç²¾å‡†åˆ†æï¼** ğŸ™

è¿™æ¬¡ä¿®å¤çœŸæ­£è§£å†³äº†é—®é¢˜çš„æ ¹æºï¼Œè€Œä¸ä»…ä»…æ˜¯è¡¨é¢ç—‡çŠ¶ã€‚
